<mxfile host="app.diagrams.net" modified="2024-12-05T00:00:00.000Z" agent="Claude Code" version="21.0.0">
  <diagram name="NBA Stats Chat Architecture" id="architecture">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="NBA Player Analytics - System Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="400" height="40" as="geometry" />
        </mxCell>

        <!-- User -->
        <mxCell id="user" value="User" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="200" width="40" height="80" as="geometry" />
        </mxCell>

        <!-- Streamlit Cloud -->
        <mxCell id="streamlit-cloud" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="200" y="120" width="400" height="280" as="geometry" />
        </mxCell>
        <mxCell id="streamlit-label" value="Streamlit Cloud" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="330" y="130" width="140" height="20" as="geometry" />
        </mxCell>

        <!-- Streamlit App -->
        <mxCell id="streamlit-app" value="Streamlit App&#xa;(app/main.py)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="230" y="170" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- LLM Interpreter -->
        <mxCell id="llm-interpreter" value="LLM Interpreter&#xa;(app/llm_interpreter.py)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="230" y="260" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- SQL Executor -->
        <mxCell id="sql-executor" value="SQL Executor&#xa;(app/executor_sql.py)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="380" y="260" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- NBA Analyzer SQL -->
        <mxCell id="analyzer" value="NBAAnalyzerSQL&#xa;(src/analysis_sql.py)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="450" y="170" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- Anthropic API -->
        <mxCell id="anthropic" value="Anthropic API&#xa;(Claude Haiku 4.5)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="230" y="450" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- CockroachDB -->
        <mxCell id="cockroachdb" value="CockroachDB Cloud&#xa;(PostgreSQL互換)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="700" y="180" width="140" height="100" as="geometry" />
        </mxCell>

        <!-- DB Tables -->
        <mxCell id="tables" value="Tables:&#xa;- boxscore (1.68M rows)&#xa;- games (76K rows)&#xa;- player_info&#xa;- player_image&#xa;- query_history" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="700" y="300" width="140" height="100" as="geometry" />
        </mxCell>

        <!-- Arrows -->
        <!-- User to Streamlit -->
        <mxCell id="arrow1" value="Natural Language&#xa;Query" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#333333;" edge="1" parent="1" source="user" target="streamlit-app">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Streamlit to LLM Interpreter -->
        <mxCell id="arrow2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#333333;" edge="1" parent="1" source="streamlit-app" target="llm-interpreter">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- LLM Interpreter to Anthropic -->
        <mxCell id="arrow3" value="API Call" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#b85450;dashed=1;" edge="1" parent="1" source="llm-interpreter" target="anthropic">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- LLM Interpreter to SQL Executor -->
        <mxCell id="arrow4" value="Parsed&#xa;Params" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#333333;" edge="1" parent="1" source="llm-interpreter" target="sql-executor">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- SQL Executor to Analyzer -->
        <mxCell id="arrow5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#333333;" edge="1" parent="1" source="sql-executor" target="analyzer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Analyzer to CockroachDB -->
        <mxCell id="arrow6" value="SQL Query" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#6c8ebf;" edge="1" parent="1" source="analyzer" target="cockroachdb">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="700" y="450" width="180" height="130" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="Legend" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="760" y="455" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend1" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="710" y="480" width="20" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend1-text" value="Frontend" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="740" y="478" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend2" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="710" y="505" width="20" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend2-text" value="LLM Layer" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="740" y="503" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend3" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="710" y="530" width="20" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend3-text" value="Data Layer" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="740" y="528" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend4" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="710" y="555" width="20" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend4-text" value="External API" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="740" y="553" width="70" height="20" as="geometry" />
        </mxCell>

        <!-- Data Flow Label -->
        <mxCell id="flow-label" value="Data Flow" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=2" vertex="1" parent="1">
          <mxGeometry x="500" y="500" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="flow-desc" value="1. User enters natural language query&#xa;2. LLM interprets and extracts parameters&#xa;3. SQL Executor builds and runs query&#xa;4. Results displayed with Plotly charts" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="420" y="520" width="250" height="70" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>